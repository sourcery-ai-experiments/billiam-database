{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v5.json", "dbt_version": "1.7.13", "generated_at": "2024-04-23T08:08:36.515546Z", "invocation_id": "db50b938-126e-4f58-97c4-eb3a3df9ca6e", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:35.683376Z", "completed_at": "2024-04-23T08:08:35.700730Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:35.701933Z", "completed_at": "2024-04-23T08:08:35.701946Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.02082061767578125, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.billiam_database.stg__daily_tracker", "compiled": true, "compiled_code": "\n\n\nWITH\n    src_tracker AS (\n        SELECT *\n        FROM 'billiam_database/models/source/daily_tracker.csv'\n    ),\n\nfinal as (\n    -- noqa: disable=ST06\n    select\n        date_time::timestamp as date_time,\n        trim(\"task\") as \"task\",\n        coalesce(trim(detail), '') as detail,\n        \"interval\"::integer as \"interval\",\n        trim(company) as company\n    from src_tracker\n    -- noqa: enable=ST06\n)\n\nselect * from final", "relation_name": "billiam.staging.daily_tracker"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:35.705757Z", "completed_at": "2024-04-23T08:08:35.709888Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:35.711085Z", "completed_at": "2024-04-23T08:08:35.711091Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0074214935302734375, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.billiam_database.stg__finances", "compiled": true, "compiled_code": "\n\n\nWITH\n    src_finances AS (\n        SELECT *\n        FROM 'billiam_database/models/source/finances.csv'\n    ),\n\nfinal as (\n    -- noqa: disable=ST06, RF06\n    select\n        row_number() over () as row_id,  /* Just for maintaining uniqueness */\n        \"Transaction\"::int as transaction_id,\n        \"Date\"::date as transaction_date,\n        trim(\"Item\") as item,\n        translate(\"Cost\", '\u00a3,', '')::decimal(18, 2) as \"cost\",\n        trim(\"Category\") as category,\n        trim(\"Retailer\") as counterparty,\n        trim(\"Payment Method\") as payment_method,  -- noqa: RF05\n        coalesce(\"Exclusion\"::bool, false) as exclusion_flag,\n        \"Reimbursement Transaction\"::int as reimbursement_transaction_id  -- noqa: RF05\n    from src_finances\n    -- noqa: enable=ST06, RF06\n)\n\nselect * from final", "relation_name": "billiam.staging.finances"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:35.714765Z", "completed_at": "2024-04-23T08:08:35.720002Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:35.721125Z", "completed_at": "2024-04-23T08:08:35.721132Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008452653884887695, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.billiam_database.stg__monzo_transactions", "compiled": true, "compiled_code": "\n\n\nWITH\n    src_monzo_transactions AS (\n        SELECT *\n        FROM 'billiam_database/models/source/monzo_transactions.csv'\n    ),\n\nfinal as (\n    -- noqa: disable=ST06, RF06\n    select\n        \"Transaction ID\" as transaction_id,  -- noqa: RF05\n        \"Date\"::date as transaction_date,\n        \"Time\"::time as transaction_time,\n        trim(\"Type\") as \"type\",\n        trim(\"Name\") as counterparty,\n        \"Emoji\" as emoji,\n        trim(\"Category\") as category,\n        -\"Amount\"::decimal(18, 2) as \"cost\",\n        \"Currency\" as currency,\n        -\"Local amount\"::decimal(18, 2) as local_cost,  -- noqa: RF05\n        \"Local currency\" as local_currency,  -- noqa: RF05\n        \"Notes and #tags\" as notes,  -- noqa: RF05\n        \"Address\" as address,\n        trim(\"Receipt\") as receipt,\n        trim(\"Description\") as description,\n        \"Category split\" as category_split,  -- noqa: RF05\n    from src_monzo_transactions\n    -- noqa: enable=ST06, RF06\n)\n\nselect * from final", "relation_name": "billiam.staging.monzo_transactions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:35.724707Z", "completed_at": "2024-04-23T08:08:35.727518Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:35.728629Z", "completed_at": "2024-04-23T08:08:35.728636Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.005982637405395508, "adapter_response": {}, "message": null, "failures": null, "unique_id": "operation.billiam_database.billiam_database-on-run-end-0", "compiled": true, "compiled_code": "", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:35.731984Z", "completed_at": "2024-04-23T08:08:35.736087Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:35.737208Z", "completed_at": "2024-04-23T08:08:35.737214Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007273435592651367, "adapter_response": {}, "message": null, "failures": null, "unique_id": "operation.billiam_database.billiam_database-on-run-start-0", "compiled": true, "compiled_code": "\n    \n    \n    \n    CREATE OR REPLACE MACRO within(expr, lower_bound, upper_bound) AS\n        GREATEST(LEAST(expr, upper_bound), lower_bound)\n    ;\n;\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:35.740597Z", "completed_at": "2024-04-23T08:08:35.804217Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:35.805389Z", "completed_at": "2024-04-23T08:08:35.805398Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.06977248191833496, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.billiam_database.int__task_details", "compiled": true, "compiled_code": "\n\n\n-- noqa: disable=PRS\n-- The `interval` column in `stg__daily_tracker` can't be parsed\nWITH\n    src_tracker AS (\n        SELECT \n          /* no columns returned from star() macro */\n        FROM billiam.staging.daily_tracker\n    ),\n-- noqa: enable=PRS\n\nfinal as (\n    -- noqa: disable=ST06\n    select\n        grouping_id(\"task\", detail) as group_id,\n        case grouping_id(\"task\", detail)\n            when 0 then 'Task and detail'\n            when 1 then 'Task only'\n        end as group_description,\n        \"task\",\n        coalesce(detail, '') as detail,\n\n        count(*) as total_records,\n        sum(\"interval\") as total_time,\n        min(date_time) as start_time,\n        max(date_time) as end_time,\n    from src_tracker\n    -- noqa: disable=CP02, RF06, PRS\n    -- SQLFluff thinks that `GROUPING SETS` is a column name?!\n    group by grouping sets (\n        (\"task\", detail),\n        (\"task\")\n    )\n    -- noqa: enable=CP02, RF06, PRS\n)\n\nselect * from final", "relation_name": "billiam.intermediate.task_details"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:35.812075Z", "completed_at": "2024-04-23T08:08:35.824821Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:35.825995Z", "completed_at": "2024-04-23T08:08:35.826001Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.016278505325317383, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.accepted_values_stg__daily_tracker_company__TSB__Jaja__Allica__Sainsbury_s.9489542842", "compiled": true, "compiled_code": "\n    \n    \n\nwith all_values as (\n\n    select\n        company as value_field,\n        count(*) as n_records\n\n    from billiam.staging.daily_tracker\n    group by company\n\n)\n\nselect *\nfrom all_values\nwhere value_field not in (\n    'TSB','Jaja','Allica','Sainsbury''s'\n)\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:35.829551Z", "completed_at": "2024-04-23T08:08:35.879099Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:35.880266Z", "completed_at": "2024-04-23T08:08:35.880274Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.05281877517700195, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.not_null_stg__daily_tracker_company.f15160b208", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect company\nfrom billiam.staging.daily_tracker\nwhere company is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:35.883731Z", "completed_at": "2024-04-23T08:08:35.888136Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:35.889257Z", "completed_at": "2024-04-23T08:08:35.889262Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007582664489746094, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.not_null_stg__daily_tracker_date_time.107b919c02", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect date_time\nfrom billiam.staging.daily_tracker\nwhere date_time is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:35.892587Z", "completed_at": "2024-04-23T08:08:35.896929Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:35.898063Z", "completed_at": "2024-04-23T08:08:35.898067Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007569074630737305, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.not_null_stg__daily_tracker_detail.1496e623bf", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect detail\nfrom billiam.staging.daily_tracker\nwhere detail is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:35.901480Z", "completed_at": "2024-04-23T08:08:35.905855Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:35.907019Z", "completed_at": "2024-04-23T08:08:35.907023Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0075969696044921875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.not_null_stg__daily_tracker_interval.be586110d9", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect interval\nfrom billiam.staging.daily_tracker\nwhere interval is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:35.910437Z", "completed_at": "2024-04-23T08:08:35.914619Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:35.915758Z", "completed_at": "2024-04-23T08:08:35.915762Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007471323013305664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.not_null_stg__daily_tracker_task.c199f695e0", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect task\nfrom billiam.staging.daily_tracker\nwhere task is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:35.919184Z", "completed_at": "2024-04-23T08:08:35.948229Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:35.949401Z", "completed_at": "2024-04-23T08:08:35.949405Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.032434940338134766, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.stg__daily_tracker", "compiled": true, "compiled_code": "\n  \n  \n\n\n  \n    \n      select * from (select 1) as t where 1 = 0\n    \n  \n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:35.952901Z", "completed_at": "2024-04-23T08:08:35.960512Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:35.961650Z", "completed_at": "2024-04-23T08:08:35.961655Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010906696319580078, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.unique_stg__daily_tracker_date_time.d1b1f0cab2", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    date_time as unique_field,\n    count(*) as n_records\n\nfrom billiam.staging.daily_tracker\nwhere date_time is not null\ngroup by date_time\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:35.965045Z", "completed_at": "2024-04-23T08:08:35.996323Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:35.997482Z", "completed_at": "2024-04-23T08:08:35.997487Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.03732919692993164, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.billiam_database.int__transactions", "compiled": true, "compiled_code": "\n\n\nWITH\n    stg_finances AS (\n        SELECT \n          /* no columns returned from star() macro */\n        FROM billiam.staging.finances\n    ),\n\nfinal as (\n    select\n        transaction_id,\n        transaction_date,\n        round(sum(\"cost\"), 2) as \"cost\",\n        count(*) as item_count,\n        group_concat(distinct counterparty, '||') as counterparty,\n    from stg_finances\n    group by transaction_id, transaction_date\n    having not (count(*) = 2 and round(sum(\"cost\"), 2) = 0)  /* Exclude credit repayment transactions */\n    order by transaction_id\n)\n\nselect * from final", "relation_name": "billiam.intermediate.transactions"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.004011Z", "completed_at": "2024-04-23T08:08:36.008337Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.009482Z", "completed_at": "2024-04-23T08:08:36.009486Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0077762603759765625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.not_null_stg__finances_category.47765b77f9", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect category\nfrom billiam.staging.finances\nwhere category is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.012888Z", "completed_at": "2024-04-23T08:08:36.017187Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.018360Z", "completed_at": "2024-04-23T08:08:36.018364Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00761866569519043, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.not_null_stg__finances_cost.437ec48b36", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect cost\nfrom billiam.staging.finances\nwhere cost is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.021809Z", "completed_at": "2024-04-23T08:08:36.026104Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.027258Z", "completed_at": "2024-04-23T08:08:36.027262Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0075151920318603516, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.not_null_stg__finances_counterparty.3abba3e86c", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect counterparty\nfrom billiam.staging.finances\nwhere counterparty is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.030636Z", "completed_at": "2024-04-23T08:08:36.034966Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.036097Z", "completed_at": "2024-04-23T08:08:36.036102Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007599592208862305, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.not_null_stg__finances_exclusion_flag.ed5156eebb", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect exclusion_flag\nfrom billiam.staging.finances\nwhere exclusion_flag is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.039451Z", "completed_at": "2024-04-23T08:08:36.045281Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.046436Z", "completed_at": "2024-04-23T08:08:36.046440Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009080886840820312, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.not_null_stg__finances_item.58714b3ccc", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect item\nfrom billiam.staging.finances\nwhere item is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.049775Z", "completed_at": "2024-04-23T08:08:36.054082Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.055240Z", "completed_at": "2024-04-23T08:08:36.055244Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007531166076660156, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.not_null_stg__finances_payment_method.3423839e55", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect payment_method\nfrom billiam.staging.finances\nwhere payment_method is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.058638Z", "completed_at": "2024-04-23T08:08:36.062771Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.063911Z", "completed_at": "2024-04-23T08:08:36.063915Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007435798645019531, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.not_null_stg__finances_row_id.b35b6b6055", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect row_id\nfrom billiam.staging.finances\nwhere row_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.067301Z", "completed_at": "2024-04-23T08:08:36.071543Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.072681Z", "completed_at": "2024-04-23T08:08:36.072685Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00750732421875, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.not_null_stg__finances_transaction_date.c4a917f991", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect transaction_date\nfrom billiam.staging.finances\nwhere transaction_date is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.076053Z", "completed_at": "2024-04-23T08:08:36.080385Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.081532Z", "completed_at": "2024-04-23T08:08:36.081536Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007565736770629883, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.not_null_stg__finances_transaction_id.a4c3a99b45", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect transaction_id\nfrom billiam.staging.finances\nwhere transaction_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.084928Z", "completed_at": "2024-04-23T08:08:36.093268Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.094465Z", "completed_at": "2024-04-23T08:08:36.094470Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.01161336898803711, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.relationships_stg__finances_reimbursement_transaction_id__transaction_id__ref_stg__finances_.ea59af76e0", "compiled": true, "compiled_code": "\n    \n    \n\nwith child as (\n    select reimbursement_transaction_id as from_field\n    from (select * from billiam.staging.finances where reimbursement_transaction_id IS NOT NULL) dbt_subquery\n    where reimbursement_transaction_id is not null\n),\n\nparent as (\n    select transaction_id as to_field\n    from billiam.staging.finances\n)\n\nselect\n    from_field\n\nfrom child\nleft join parent\n    on child.from_field = parent.to_field\n\nwhere parent.to_field is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.097826Z", "completed_at": "2024-04-23T08:08:36.104558Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.105690Z", "completed_at": "2024-04-23T08:08:36.105694Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009948492050170898, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.stg__finances", "compiled": true, "compiled_code": "\n  \n  \n\n\n  \n    \n      select * from (select 1) as t where 1 = 0\n    \n  \n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.109075Z", "completed_at": "2024-04-23T08:08:36.113353Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.114516Z", "completed_at": "2024-04-23T08:08:36.114521Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007559776306152344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.unique_stg__finances_row_id.eaaeda8cae", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    row_id as unique_field,\n    count(*) as n_records\n\nfrom billiam.staging.finances\nwhere row_id is not null\ngroup by row_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.117899Z", "completed_at": "2024-04-23T08:08:36.159685Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.160852Z", "completed_at": "2024-04-23T08:08:36.160856Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.047777652740478516, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.assert__monzo_transactions_reconcile__tfl", "compiled": true, "compiled_code": "\n\n\n\n\nWITH RECURSIVE\n    stg_finances AS (\n        SELECT \n          /* no columns returned from star() macro */\n        FROM billiam.staging.finances\n    ),\n    stg_monzo_transactions AS (\n        SELECT \n          /* no columns returned from star() macro */\n        FROM billiam.staging.monzo_transactions\n    ),\n\nmy_txns AS (\n    SELECT\n        transaction_date,\n        SUM(cost)::NUMERIC(18, 2) AS cost,\n    FROM stg_finances\n    WHERE counterparty = 'TfL'\n      AND payment_method = 'Monzo'\n    GROUP BY transaction_date\n),\nmonzo_txns AS (\n    SELECT\n        transaction_date,\n        SUM(cost)::NUMERIC(18, 2) AS cost,\n    FROM stg_monzo_transactions\n    WHERE counterparty = 'Transport for London'\n      AND cost != 0\n    GROUP BY transaction_date\n),\n\ndates AS (\n        SELECT MIN(transaction_date) AS transaction_date\n        FROM my_txns\n    UNION ALL\n        SELECT transaction_date + INTERVAL 1 DAY\n        FROM dates\n        WHERE transaction_date < CURRENT_DATE\n),\n\njoined AS (\n    SELECT\n        transaction_date,\n        COALESCE(my_txns.cost, 0) AS cost__mine,\n        COALESCE(monzo_txns.cost, 0) AS cost__monzo,\n\n        SUM(cost__mine)  OVER t_date AS running_cost__mine,\n        SUM(cost__monzo) OVER t_date AS running_cost__monzo,\n\n        running_cost__mine = running_cost__monzo AS match_flag\n    FROM dates\n        LEFT JOIN my_txns    USING (transaction_date)\n        LEFT JOIN monzo_txns USING (transaction_date)\n    WINDOW t_date AS (ORDER BY transaction_date)\n)\n\n/*\nFor now, we just match \"close enough\" -- this is because the transactions\nare recorded at different times between the sources _and_ because the\ngrain is different, so it's harder to join them together with integrity.\n\nRemember that the `stg__finances` model records each _journey_, whereas\nthe `stg__monzo_transactions` model records each _transaction_ which can\ncorrespond to several journeys.\n\nWe apply an 80% match threshold to the running total, so if the running\ntotal is out for more than 20% of cases we flag this as a failure.\n*/\nSELECT 1.0 * SUM(match_flag::INT) / COUNT(*) AS match_ratio\nFROM joined\nHAVING match_ratio < 0.80", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.167134Z", "completed_at": "2024-04-23T08:08:36.171645Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.172767Z", "completed_at": "2024-04-23T08:08:36.172771Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00777888298034668, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.not_null_stg__monzo_transactions_transaction_date.ef899ac49c", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect transaction_date\nfrom billiam.staging.monzo_transactions\nwhere transaction_date is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.176159Z", "completed_at": "2024-04-23T08:08:36.180559Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.181684Z", "completed_at": "2024-04-23T08:08:36.181688Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0076236724853515625, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.not_null_stg__monzo_transactions_transaction_id.c828f70f9a", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect transaction_id\nfrom billiam.staging.monzo_transactions\nwhere transaction_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.185124Z", "completed_at": "2024-04-23T08:08:36.190982Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.192108Z", "completed_at": "2024-04-23T08:08:36.192113Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009070873260498047, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.not_null_stg__monzo_transactions_transaction_time.dd063588dc", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect transaction_time\nfrom billiam.staging.monzo_transactions\nwhere transaction_time is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.195498Z", "completed_at": "2024-04-23T08:08:36.199749Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.200891Z", "completed_at": "2024-04-23T08:08:36.200896Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0075452327728271484, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.not_null_stg__monzo_transactions_type.e75292d3fe", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect type\nfrom billiam.staging.monzo_transactions\nwhere type is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.204289Z", "completed_at": "2024-04-23T08:08:36.209460Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.210629Z", "completed_at": "2024-04-23T08:08:36.210633Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008409738540649414, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.stg__monzo_transactions", "compiled": true, "compiled_code": "\n  \n  \n\n\n  \n    \n      select * from (select 1) as t where 1 = 0\n    \n  \n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.214044Z", "completed_at": "2024-04-23T08:08:36.218297Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.219470Z", "completed_at": "2024-04-23T08:08:36.219474Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007561445236206055, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.unique_stg__monzo_transactions_transaction_id.504c465268", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    transaction_id as unique_field,\n    count(*) as n_records\n\nfrom billiam.staging.monzo_transactions\nwhere transaction_id is not null\ngroup by transaction_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.222863Z", "completed_at": "2024-04-23T08:08:36.253101Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.254294Z", "completed_at": "2024-04-23T08:08:36.254298Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.03635597229003906, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.billiam_database.pl__task_details", "compiled": true, "compiled_code": "\n\n\nWITH\n    src_task_details AS (\n        SELECT \n          /* no columns returned from star() macro */\n        FROM billiam.intermediate.task_details\n    ),\n\nfinal as (\n    select\n        group_id::int as group_id,\n        group_description,\n        \"task\",\n        detail,\n        total_records::int as total_records,\n        total_time::int as total_time,\n        start_time,\n        end_time,\n    from src_task_details\n)\n\nselect * from final", "relation_name": "billiam.presentation.task_details"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.260659Z", "completed_at": "2024-04-23T08:08:36.267466Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.268601Z", "completed_at": "2024-04-23T08:08:36.268605Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.010068178176879883, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.int__task_details", "compiled": true, "compiled_code": "\n  \n  \n\n\n  \n    \n      select * from (select 1) as t where 1 = 0\n    \n  \n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.272039Z", "completed_at": "2024-04-23T08:08:36.312737Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.313888Z", "completed_at": "2024-04-23T08:08:36.313892Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.04659533500671387, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.billiam_database.int__transaction_items", "compiled": true, "compiled_code": "\n\n\nWITH\n    stg_finances AS (\n        SELECT \n          /* no columns returned from star() macro */\n        FROM billiam.staging.finances\n    ),\n    int_transactions AS (\n        SELECT \n          /* no columns returned from star() macro */\n        FROM billiam.intermediate.transactions\n    ),\n\nfinal as (\n    select\n        row_id,\n        transaction_date,\n        transaction_id,\n        item,\n        \"cost\",\n        category,\n        counterparty,\n        exclusion_flag,\n    from stg_finances\n    -- noqa: disable=LT02\n    where transaction_id in (\n        /*\n            Only keep the items for transactions that haven't been filtered out.\n        */\n        select transaction_id\n        from int_transactions\n    )\n    -- noqa: enable=LT02\n    order by row_id\n)\n\nselect * from final", "relation_name": "billiam.intermediate.transaction_items"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.320239Z", "completed_at": "2024-04-23T08:08:36.334071Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.335287Z", "completed_at": "2024-04-23T08:08:36.335291Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.017322778701782227, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.dbt_expectations_expect_column_values_to_not_match_like_pattern_int__transactions_counterparty___.9e9aa7b732", "compiled": true, "compiled_code": "\n\n\n\n\n    with grouped_expression as (\n    select\n        \n        \n    \n  \ncounterparty not like '%||%'\n as expression\n\n\n    from billiam.intermediate.transactions\n    \n\n),\nvalidation_errors as (\n\n    select\n        *\n    from\n        grouped_expression\n    where\n        not(expression = true)\n\n)\n\nselect *\nfrom validation_errors\n\n\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.338750Z", "completed_at": "2024-04-23T08:08:36.345075Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.346238Z", "completed_at": "2024-04-23T08:08:36.346242Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009661674499511719, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.int__transactions", "compiled": true, "compiled_code": "-- depends_on: \"DBT_CTE__stg__finances\"\n\n\n\n  \n  \n\n\n  \n    \n      select * from (select 1) as t where 1 = 0\n    \n  \n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.349604Z", "completed_at": "2024-04-23T08:08:36.353867Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.355034Z", "completed_at": "2024-04-23T08:08:36.355038Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.0075986385345458984, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.not_null_int__transactions_cost.a8611301e0", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect cost\nfrom billiam.intermediate.transactions\nwhere cost is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.358496Z", "completed_at": "2024-04-23T08:08:36.364365Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.365498Z", "completed_at": "2024-04-23T08:08:36.365503Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.009119510650634766, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.not_null_int__transactions_counterparty.025e0c3eba", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect counterparty\nfrom billiam.intermediate.transactions\nwhere counterparty is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.368847Z", "completed_at": "2024-04-23T08:08:36.373080Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.374209Z", "completed_at": "2024-04-23T08:08:36.374231Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007425069808959961, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.not_null_int__transactions_item_count.100a08d5ac", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect item_count\nfrom billiam.intermediate.transactions\nwhere item_count is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.377573Z", "completed_at": "2024-04-23T08:08:36.381890Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.383061Z", "completed_at": "2024-04-23T08:08:36.383065Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007541179656982422, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.not_null_int__transactions_transaction_id.e2594cdecd", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect transaction_id\nfrom billiam.intermediate.transactions\nwhere transaction_id is null\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.386442Z", "completed_at": "2024-04-23T08:08:36.390706Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.391845Z", "completed_at": "2024-04-23T08:08:36.391849Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007542133331298828, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.unique_int__transactions_transaction_id.9091bfb381", "compiled": true, "compiled_code": "\n    \n    \n\nselect\n    transaction_id as unique_field,\n    count(*) as n_records\n\nfrom billiam.intermediate.transactions\nwhere transaction_id is not null\ngroup by transaction_id\nhaving count(*) > 1\n\n\n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.395272Z", "completed_at": "2024-04-23T08:08:36.400425Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.401571Z", "completed_at": "2024-04-23T08:08:36.401575Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.00842905044555664, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.pl__task_details", "compiled": true, "compiled_code": "\n  \n  \n\n\n  \n    \n      select * from (select 1) as t where 1 = 0\n    \n  \n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.405013Z", "completed_at": "2024-04-23T08:08:36.447831Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.449000Z", "completed_at": "2024-04-23T08:08:36.449004Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.04883742332458496, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.billiam_database.pl__daily_metrics", "compiled": true, "compiled_code": "\n\n/*\n    Will break this down into smaller models later\n*/\n\n\n-- noqa: disable=PRS\n-- The `interval` column in `stg__daily_tracker` can't be parsed\nWITH RECURSIVE\n    src_transactions AS (\n        SELECT \n          /* no columns returned from star() macro */\n        FROM billiam.intermediate.transaction_items\n    ),\n    src_tracker AS (\n        SELECT \n          /* no columns returned from star() macro */\n        FROM billiam.staging.daily_tracker\n    ),\n-- noqa: enable=PRS\n\ndate_dim as (\n    -- noqa: disable=LT02\n        select '2018-01-01'::date as metric_date\n    union all\n        select metric_date + interval 1 day\n        from date_dim\n        where metric_date < current_date\n    -- noqa: enable=LT02\n),\n\ndaily_transactions as (\n    select\n        transaction_date as metric_date,\n        sum(\"cost\") as total_cost,\n        sum(\"cost\") filter (where category not in ('Bills', 'Council Tax', 'Rent', 'Wage')) as non_essential_cost,\n        within(round(100.0 * non_essential_cost / total_cost, 4), 0, 100) as non_essential_cost_proportion,\n    from src_transactions\n    where not exclusion_flag\n    group by transaction_date\n),  -- noqa: LT08\ndaily_work as (\n    select\n        date_time::date as metric_date,\n        sum(\"interval\") as total_working_time,\n        sum(\"interval\") filter (where \"task\" in ('Meetings', 'Catch Up')) as meeting_time,\n        round(100.0 * meeting_time / total_working_time, 4) as meeting_proportion,\n        round(100.0 * meeting_time / least(total_working_time, 7.5 * 60), 4) as working_day_meeting_proportion,\n    from src_tracker\n    group by date_time::date\n),\n\nfinal as (\n    select\n        date_dim.metric_date,\n\n        coalesce(daily_transactions.total_cost, 0)::decimal(18, 3) as total_cost,\n        coalesce(daily_transactions.non_essential_cost, 0)::decimal(18, 3) as non_essential_cost,\n        coalesce(daily_transactions.non_essential_cost_proportion, 0)::decimal(8, 4) as non_essential_cost_proportion,\n        coalesce(daily_work.total_working_time, 0)::int as total_working_time,\n        coalesce(daily_work.meeting_time, 0)::int as meeting_time,\n        coalesce(daily_work.meeting_proportion, 0)::decimal(8, 4) as meeting_proportion,\n        coalesce(daily_work.working_day_meeting_proportion, 0)::decimal(8, 4) as working_day_meeting_proportion,\n    from date_dim\n        left join daily_transactions using (metric_date)\n        left join daily_work using (metric_date)\n    order by date_dim.metric_date\n)\n\nselect * from final", "relation_name": "billiam.presentation.daily_metrics"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.455257Z", "completed_at": "2024-04-23T08:08:36.489303Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.490492Z", "completed_at": "2024-04-23T08:08:36.490497Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.039938926696777344, "adapter_response": {}, "message": null, "failures": null, "unique_id": "model.billiam_database.pl__transactions_cube", "compiled": true, "compiled_code": "\n\n\n/*\n    Not helpful for me, but illustrates the usage\n*/\n\nWITH\n    int_transaction_items AS (\n        SELECT \n          /* no columns returned from star() macro */\n        FROM billiam.intermediate.transaction_items\n    ),\n\nfinal as (\n    -- noqa: disable=ST06\n    select\n        grouping_id(\n            transaction_date,\n            category,\n            counterparty,\n            exclusion_flag\n        ) as group_id,\n        transaction_date,\n        category,\n        counterparty,\n        exclusion_flag,\n\n        count(distinct transaction_id) as total_transaction_count,\n        count(*) as total_item_count,\n        count(distinct item) as distinct_item_count,\n        sum(\"cost\") as total_cost,\n        avg(\"cost\") as average_cost,\n        min(\"cost\") as min_cost,\n        max(\"cost\") as max_cost,\n        stddev_pop(\"cost\") as standard_dev_cost,\n    from int_transaction_items\n    -- noqa: enable=ST06\n    \n    group by cube(\n        transaction_date,\n        category,\n        counterparty,\n        exclusion_flag\n    )\n)\n\nselect * from final", "relation_name": "billiam.presentation.transactions_cube"}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.496601Z", "completed_at": "2024-04-23T08:08:36.502163Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.503347Z", "completed_at": "2024-04-23T08:08:36.503351Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.008861064910888672, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.int__transaction_items", "compiled": true, "compiled_code": "\n  \n  \n\n\n  \n    \n      select * from (select 1) as t where 1 = 0\n    \n  \n", "relation_name": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2024-04-23T08:08:36.506785Z", "completed_at": "2024-04-23T08:08:36.511027Z"}, {"name": "execute", "started_at": "2024-04-23T08:08:36.512141Z", "completed_at": "2024-04-23T08:08:36.512145Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.007462263107299805, "adapter_response": {}, "message": null, "failures": null, "unique_id": "test.billiam_database.not_null_int__transaction_items_exclusion_flag.405d57b4a7", "compiled": true, "compiled_code": "\n    \n    \n\n\n\nselect exclusion_flag\nfrom billiam.intermediate.transaction_items\nwhere exclusion_flag is null\n\n\n", "relation_name": null}], "elapsed_time": 0.9648129940032959, "args": {"use_experimental_parser": true, "populate_cache": true, "exclude": [], "show_resource_report": false, "empty_catalog": false, "partial_parse": true, "printer_width": 80, "profiles_dir": "billiam_database/", "use_colors_file": true, "which": "generate", "warn_error_options": {"include": [], "exclude": []}, "version_check": true, "cache_selected_only": false, "log_level": "info", "project_dir": "billiam_database/", "select": [], "log_format": "default", "static": false, "vars": {}, "static_parser": true, "send_anonymous_usage_stats": true, "macro_debugging": false, "partial_parse_file_diff": true, "compile": true, "log_path": "billiam_database/logs", "print": true, "indirect_selection": "eager", "use_colors": true, "defer": false, "log_level_file": "debug", "strict_mode": false, "introspect": true, "log_file_max_bytes": 10485760, "favor_state": false, "write_json": true, "enable_legacy_logger": false, "quiet": false, "invocation_command": "dbt docs generate", "log_format_file": "default"}}